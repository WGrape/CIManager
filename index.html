<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CIManager</title>

    <style>* {
        margin: 0;
    }

    body {
        margin-bottom: 20px;
    }

    .fs-13 {
        font-size: 13px;
    }

    h4 {
        margin: 20px auto 10px auto;
        padding-bottom: 8px;
        margin-bottom: 0;
    }

    h3{
    }

    td {
        font-size: 12px;
        border: 1px solid #ddd;
        text-align: center;
        padding: 15px 10px;
        word-wrap: break-word;
        word-break: normal;
    }

    p {
        /*height: 30px;*/
        line-height: 30px;
        margin: 0;
        color:#666;
        padding: 10px 0;
        text-align: justify;
    }

    pre{
        background: #eee;
        padding: 10px 15px 10px 15px;
        margin-bottom: 20px;
    }

    #View-introduce-body,#View-deploy-body,#View-help-body,#View-comment-body{
        margin-top: 20px;
    }
    </style>

    <style>
        * {
            margin: 0;
            padding: 0;
        }

        body {
            min-width: 1420px;
        }

        iframe {
            border: none;
            box-shadow: none;
        }

        ul, li {
            list-style: none;
        }

        li {
            display: inline-block;
        }

        li.timeline {
            border-left: 1px solid #ccc;
            padding: 0 10px 30px 30px;
            width: 1100px;
        }

        li.timeline:before {
            content: " ";
            width: 15px;
            height: 15px;
            background: #5f71d5;
            color: #000;
            border-radius: 20px;
            display: inline-block;
            margin-left: -38px;
        }

        input[type='text'] {
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 220px;
            height: 30px;
            line-height: 30px;
            padding: 5px 10px;
            outline: none;
        }

        input[type='text'].input-logid {
            width: 400px;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
            border-right: 0;
            color: #555;
            padding-left: 15px;
            height: 25px;
            line-height: 25px;
        }

        input[type='radio'] {
            cursor: pointer;
        }

        button {
            height: 35px;
            line-height: 35px;
            text-align: center;
            border: none;
            cursor: pointer;
            outline: none;
        }

        label {
            cursor: pointer;
            margin-right: 5px;
        }

        #Head {
            /*background: #515faf;*/
            color: #FFF;
            text-align: left;
            padding: 0 15px;
            /*height: 78px;*/
            /*line-height: 78px;*/
            height: 100px;
            line-height: 100px;
            border-bottom: 10px solid #eee;
        }

        #Dashboard {
            display: inline-block;
            width: 20%;
            max-width: 200px;
            float: left;
            /*background: #202020;*/
            background: #2c3772;
            border-right: 10px solid #eee;
            margin-top: -10px;
        }

        #View {
            display: inline-block;
            width: 70%;
            padding: 0 0 20px 0;
        }

        #Foot {
            background: #eee;
            border-top: 1px solid #ddd;
            padding: 20px 0;
        }

        #Loading {
            display: none;
        }

        .no_a {
            text-decoration: none;
            color: #FFF;
        }

        .bb {
            border-bottom: 1px solid #ddd;
        }

        .pb-10 {
            padding-bottom: 10px;
        }

        .fr {
            float: right;
        }

        .fs-13 {
            font-size: 13px;
        }

        .fs-14 {
            font-size: 14px;
        }

        .fs-15 {
            font-size: 15px;
        }

        .fs-16 {
            font-size: 16px;
        }

        .fs-25 {
            font-size: 25px;
        }

        .fc-5 {
            color: #555;
        }

        .fc-3f {
            color: #3F51B5;
        }

        .ff-cursive {
            font-family: cursive;
        }

        .lighter {
            font-weight: lighter;
        }

        .ml-5 {
            margin-left: 5px;
        }

        .ml-15 {
            margin-left: 15px;
        }

        .ml-20 {
            margin-left: 20px;
        }

        .mt-5 {
            margin-top: 5px;
        }

        .mt-10 {
            margin-top: 10px;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .mt-30 {
            margin-top: 30px;
        }

        .mr-10 {
            margin-right: 10px;
        }

        .mb-10 {
            margin-bottom: 10px;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .lp-2 {
            letter-spacing: 2px;
        }

        .bg-e {
            background: #eee;
        }

        .ta-r {
            text-align: right;
        }

        .ta-c {
            text-align: center;
        }

        .dp-ib {
            display: inline-block;
        }

        .block {
            display: block;
        }

        .left {
            float: left;
        }

        .right {
            float: right;
        }

        .clear {
            clear: both;
        }

        .tab {
            height: 40px;
            line-height: 40px;
            font-size: 12px;
            text-align: center;
            padding: 5px;
            display: block;
            color: #FFF;
        }

        .tab-focus {
            border-radius: 0;
            font-size: 15px;
            font-weight: bold;
            background: #1f2755;
        }

        .tab:hover {
            cursor: pointer;
            background: #1f2755;
            font-weight: bold;
        }

        .view {
            display: none;
            padding: 30px 20px 20px 45px;
        }

        .view-focus {
            display: block;
        }

        .spinner {
            width: 150px;
            position: fixed;
            top: 30%;
            left: 50%;
        }

        .spinner > div {
            width: 30px;
            height: 30px;
            background-color: #515faf;
            border-radius: 100%;
            display: inline-block;
            -webkit-animation: bouncedelay 1.4s infinite ease-in-out;
            animation: bouncedelay 1.4s infinite ease-in-out;
            /* Prevent first frame from flickering when animation starts */
            -webkit-animation-fill-mode: both;
            animation-fill-mode: both;
        }

        .spinner .bounce1 {
            -webkit-animation-delay: -0.32s;
            animation-delay: -0.32s;
        }

        .spinner .bounce2 {
            -webkit-animation-delay: -0.16s;
            animation-delay: -0.16s;
        }

        @-webkit-keyframes bouncedelay {
            0%, 80%, 100% {
                -webkit-transform: scale(0.0)
            }
            40% {
                -webkit-transform: scale(1.0)
            }
        }

        @keyframes bouncedelay {
            0%, 80%, 100% {
                transform: scale(0.0);
                -webkit-transform: scale(0.0);
            }
            40% {
                transform: scale(1.0);
                -webkit-transform: scale(1.0);
            }
        }

        .empty-show-container {
            display: none;
            text-align: center;
        }

        .empty-show-container img {
            width: 400px;
            margin-top: 100px;
        }

        #View-introduce-head, #View-scratch-head, #View-configuration-head, #View-deploy-head, #View-help-head, #View-comment-head {
            text-align: left;
        }

        table
        {
            border-collapse: collapse;
            text-align: center;
            margin:0 0 20px 0;
        }
        table td, table th
        {
            border: 1px solid #cad9ea;
            color: #666;
            height: 30px;
        }
        table thead th
        {
            background-color: #CCE8EB;
            width: 100px;
        }
        table tr:nth-child(odd)
        {
            background: #fff;
        }
        table tr:nth-child(even)
        {
            background: #F5FAFA;
        }
        table tr:hover
        {
            background: #d0f3f7;
        }

    </style>
</head>
<body>
<div id="Head">
    <div class="dp-ib left" style="padding:13px 0 0 17px;height: 48px;">
        <a class="no_a" href="">
            <img width="150" src="https://user-images.githubusercontent.com/35942268/188274226-5ccdfb75-5bcb-4d90-895f-4190d64ae22d.png" />
        </a>

    </div>
    <div class="dp-ib fs-25 lighter left" style="margin-left: 7px;font-weight: bold;"><a class="no_a" href="/mis/run_trace/run_trace">CI Manager</a></div>
    <div class="fs-14 lighter right ff-cursive"><a class="no_a" href="/mis/run_trace/run_trace"></a></div>
</div>
<div id="Body">
    <div id="Dashboard">
        <ul>
            <li class="tab tab-introduce fc-5" data-href="?tab=introduce" id="Tab-introduce">项目介绍</li>
            <li class="tab tab-scratch fc-5" data-href="?tab=scratch" id="Tab-scratch">快速上手</li>
            <li class="tab tab-configuration fc-5" data-href="?tab=configuration" id="Tab-configuration">使用文档</li>
            <li class="tab tab-deploy fc-5" data-href="?tab=deploy" id="Tab-deploy">私有化部署</li>
            <li class="tab tab-help fc-5" data-href="?tab=comment" id="Tab-comment">评论反馈</li>
        </ul>
    </div>
    <div class="left" id="View">
        <div class="view" id="View-introduce">
            <h3 id="View-introduce-head">项目介绍</h3>
            <div id="View-introduce-body">
                <p>CIManager是一个用于高效管理多个项目通用CI/CD的轻量级开源框架。</p>
                <p><a href="https://github.com/WGrape">查看作者</a></p>
                <p><a href="https://github.com/WGrape/CIManager">源码地址</a></p>
            </div>
            <div class="empty-show-container">
                <img src="https://ae03.alicdn.com/kf/H74e64de0708845a498fe4ea8d13da9adi.jpg">
            </div>
        </div>
        <div class="view" id="View-scratch">
            <h2 id="View-scratch-head">快速上手</h2>

            <div id="View-scratch-body" style="display: block;">

                <blockquote><p>为了方便您快速应用，可以参考 <a href="https://jihulab.com/WGrape/apimock-example/">apimock-example</a> 项目是如何使用<code>CIManager</code>的</p></blockquote>

                <h3><span >1、为您的项目添加ci.yml文件</span></h3>

                <p>首先，和单项目下的CI管理方式一样，在您的各个项目下添加一个.gitlab-ci.yml或.github/workflows/.github-ci.yml配置文件。在<a href="https://github.com/WGrape/CIManager/tree/main/template">/template目录</a>下有定义好的配置文件，您可以直接使用。</p>

                <img width="300" style="margin-bottom: 10px;" src="https://github.com/WGrape/CIManager/assets/35942268/21026799-c865-4534-9342-8954cec04200">

                <h3><span >2、正常提交您的项目</span></h3>

                <p>添加完之后，如往常一样，正常编写并提交您的项目即可</p>

                <h3><span >3、CIManager开始工作</span></h3>

                <p>当您每次提交项目的时候，在runner机器上都会运行CIManager，它的底层<a href="https://github.com/WGrape/Blog/issues/249">运行原理</a>如下图所示，详细运行过程可以<a href="https://jihulab.com/WGrape/apimock-example/-/jobs/4354428">查看这里</a></p>

                <p style="height: 400px;"><img src="https://user-images.githubusercontent.com/35942268/184865495-ca6b8491-6f23-4db6-80c8-9853f677dacb.png" height="400px"></p>

            </div>

            <div class="empty-show-container">
                <img src="https://ae03.alicdn.com/kf/H74e64de0708845a498fe4ea8d13da9adi.jpg">
            </div>
        </div>
        <div class="view" id="View-configuration">
            <h2 id="View-configuration-head">使用文档</h2>

            <div id="View-configuration-body">
                <h2 style="margin-top: 20px;">一、变量配置</h2>

                <h3 style="margin-top: 20px;">1、系统变量</h3>
                <p>下面是所支持的系统级别的变量</p>
                <table>
                    <thead>
                    <tr>
                        <th>变量名</th>
                        <th>必须</th>
                        <th>含义</th>
                        <th>备注</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>GOPATH</td>
                        <td>否</td>
                        <td>Go环境配置</td>
                        <td>无</td>
                    </tr>
                    </tbody>
                </table>

                <h3>2、项目变量</h3>
                <p>下面是所支持的项目级别的变量</p>
                <table>
                    <thead>
                    <tr>
                        <th>变量名</th>
                        <th>必须</th>
                        <th>含义</th>
                        <th>备注</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>PROJECT_NAME</td>
                        <td>否</td>
                        <td>项目名称</td>
                        <td>无</td>
                    </tr>
                    </tbody>
                </table>
                <h3>3、JOB变量</h3>
                <p>下面是在不同Job中所支持的变量</p>

                <h4>(1) CI_STAGE_PRE</h4>
                <table>
                    <thead>
                    <tr>
                        <th>变量名</th>
                        <th>必须</th>
                        <th>含义</th>
                        <th>备注</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>CI_STAGE_BUILD_JOB_PRE_CHECK_CMD</td>
                        <td>否</td>
                        <td>预检查的命令</td>
                        <td>无</td>
                    </tr>
                    <tr>
                        <td>CI_STAGE_BUILD_JOB_PRE_INSTALL_CMD</td>
                        <td>否</td>
                        <td>预安装的命令</td>
                        <td>无</td>
                    </tr>
                    </tbody>
                </table>

                <h4>(2) CI_STAGE_TEST</h4>
                <table>
                    <thead>
                    <tr>
                        <th>变量名</th>
                        <th>必须</th>
                        <th>含义</th>
                        <th>备注</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>CI_STAGE_BUILD_JOB_CHECK_CODE_CMD</td>
                        <td>否</td>
                        <td>代码检查的命令</td>
                        <td>无</td>
                    </tr>
                    <tr>
                        <td>CI_STAGE_BUILD_JOB_UNIT_TEST_CMD</td>
                        <td>否</td>
                        <td>单元测试的命令</td>
                        <td>无</td>
                    </tr>
                    </tbody>
                </table>

                <h4>(3) CI_STAGE_BUILD</h4>
                <table>
                    <thead>
                    <tr>
                        <th>变量名</th>
                        <th>必须</th>
                        <th>含义</th>
                        <th>备注</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>CI_STAGE_BUILD_JOB_APIDOC_GEN_CMD</td>
                        <td>否</td>
                        <td>生成接口文档时的命令</td>
                        <td>无</td>
                    </tr>
                    <tr>
                        <td>CI_STAGE_BUILD_JOB_LOCAL_BUILD_CMD</td>
                        <td>是</td>
                        <td>项目构建时的命令</td>
                        <td>无</td>
                    </tr>
                    </tbody>
                </table>

                <h4>(4) CD_STAGE_DEPLOY</h4>
                <table>
                    <thead>
                    <tr>
                        <th>变量名</th>
                        <th>必须</th>
                        <th>含义</th>
                        <th>备注</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>CD_STAGE_MONITOR_JOB_SSH_CMD</td>
                        <td>否</td>
                        <td>执行SSH部署时的命令</td>
                        <td>无</td>
                    </tr>
                    <tr>
                        <td>CD_STAGE_MONITOR_JOB_PULL_ARTIFACT_CMD</td>
                        <td>否</td>
                        <td>使用拉取镜像部署时的命令</td>
                        <td>无</td>
                    </tr>
                    </tbody>
                </table>

                <h4>(5) CD_STAGE_MONITOR</h4>
                <table>
                    <thead>
                    <tr>
                        <th>变量名</th>
                        <th>必须</th>
                        <th>含义</th>
                        <th>备注</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>CD_STAGE_MONITOR_JOB_API_TEST_CMD</td>
                        <td>否</td>
                        <td>执行接口测试的命令</td>
                        <td>无</td>
                    </tr>
                    <tr>
                        <td>CD_STAGE_MONITOR_JOB_API_TEST_CMD_RES</td>
                        <td>否</td>
                        <td>接口请求成功时的返回内容</td>
                        <td>无</td>
                    </tr>
                    <tr>
                        <td>CD_STAGE_MONITOR_JOB_HEALTH_CHECK_CMD</td>
                        <td>否</td>
                        <td>执行健康检查的命令</td>
                        <td>无</td>
                    </tr>
                    <tr>
                        <td>CD_STAGE_MONITOR_JOB_HEALTH_CHECK_CMD_RES</td>
                        <td>否</td>
                        <td>健康检查成功时的返回内容</td>
                        <td>无</td>
                    </tr>
                    </tbody>
                </table>

            </div>

            <div class="empty-show-container">
                <img src="https://ae03.alicdn.com/kf/H74e64de0708845a498fe4ea8d13da9adi.jpg">
            </div>
        </div>
        <div class="view" id="View-deploy">
            <h2 id="View-deploy-head">私有化部署</h2>

            <div id="View-deploy-body">
                <h3>1、下载项目</h3>
                <p>无需任务复杂安装过程，直接通过Git方式clone到本地即可。</p>

                <pre>git clone https://github.com/WGrape/CIManager.git</pre>

                <h3>2、部署至私有仓库</h3>
                <p>如果您不需要对CIManager框架进行扩展开发，那么直接把它提交至您的私有仓库，并在您各个项目中的 <span style="color: #5f71d5">.gitlab-ci.yml</span> 或 <span style="color: #5f71d5">.github/workflows/.github-ci.yml</span> 配置文件中的 <span style="color: #5f71d5">https://github.com/WGrape/CIManager.git</span> 替换为CIManager在您私有仓库中的地址即可。</p>

                <h3>3、自定义开发</h3>
                <p>本框架源码轻量简单，如果不满足您的需求，您可以在CIManager框架基础上进行自定义开发，比如新增配置检查、依赖检查等丰富和加强CI/CD的流水线功能。具体请参考<a href="https://github.com/WGrape/CIManager/blob/main/doc/DESIGN.md">设计文档文档</a></p>
            </div>

            <div class="empty-show-container">
                <img src="https://ae03.alicdn.com/kf/H74e64de0708845a498fe4ea8d13da9adi.jpg">
            </div>
        </div>
        <div class="view" id="View-comment">
            <h2 id="View-comment-head">评论反馈</h2>
            <div id="View-comment-body">
                <script src="https://utteranc.es/client.js"
                        repo="wgrape/WGrape.github.io"
                        issue-term="title"
                        theme="github-light"
                        crossorigin="anonymous"
                        async>
                </script>
            </div>
            <div class="empty-show-container">
                <img src="https://ae03.alicdn.com/kf/H74e64de0708845a498fe4ea8d13da9adi.jpg">
            </div>
        </div>
    </div>
    <div class="clear"></div>
</div>
<div id="Foot">
    <div class="fs-13 ta-c" style="padding:10px 15px;">
        <span class="fc-5">了解更多 ? 请查看</span>
        <a href="https://github.com/WGrape/CIManager" target="_blank">CIManager源码</a>
        <span class="fc-5">© 2022 CIManager, Inc.</span>
    </div>
</div>
<div id="Loading">
    <div class="spinner">
        <div class="bounce1"></div>
        <div class="bounce2"></div>
        <div class="bounce3"></div>
    </div>
</div>

<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/URI.js/1.19.2/URI.min.js"></script>
<script>

    function getURLPath() {
        let origin = window.location.origin;
        let pathname = window.location.pathname;
        return origin + pathname;
    }

    function getURLQuery(query) {
        let uriObject = URI(window.location.href);
        return uriObject.query(true)[query];
    }

    function redirect(query = '') {
        window.location.href = getURLPath() + query;
    }

    function listenSwitchTab() {
        $('.tab').click(function () {
            let href = $(this).attr('data-href');
            if (typeof href === 'string' && '' !== href) {
                redirect($(this).attr('data-href'));
            }
        });
    }

    function loadView(view = 'introduce') {
        $('#View-' + view).addClass('view-focus');
        if ('introduce' === view) {
        }
    }

    function loadStyle() {
        let height = parseInt($("#View").height()) + 50;
        $("#Dashboard").height(height);
        $("#Dashboard").css('min-height', parseInt(window.innerHeight) - parseInt($("#Head").outerHeight()) - parseInt($("#Foot").outerHeight()));
    }

    function loadTab() {
        let uriObject = URI(window.location.href);
        if (false === uriObject.hasQuery('tab')) {
            $('#Tab-introduce').addClass('tab-focus');
            loadView();
            return;
        }
        let query = uriObject.query(true)['tab'];
        if (['introduce', 'scratch', 'configuration', 'deploy','help','comment'].indexOf(query) >= 0) {
            $('#Tab-' + query).addClass('tab-focus');
            loadView(query);
        } else {
            redirect();
        }
    }

    window.onload = function () {
        listenSwitchTab();
        loadTab();
        loadStyle();
    };
</script>
